---
title: Мой подход к менеджменту фоток
---

## Дано

- macbook pro 256gb SSD
- iPad mini 16гб с классной батарейкой
- iPhone 5S 16гб с не такой классной батарейкой как у iPad
- Домашний компутер с уже довольно старым 2Тб жёстким диском, который может сдохнуть
- Развитая до конца жадность (заплатить apple за iCloud чтобы там было больше 5Гб 60р в месяц жалко)
- Не развитая до конца паранойя:
    - все облака могут быть взломаны
    - более того, на моём контенте будут пытаться делать деньги
    - а потом ещё и использовать против меня
    - но с защищённостью данных на моих устройствах можно не париться
- Не сильно большое скопище фоток.
    - Раз в полгода с отпуска штук 600-700.
    - Раз в месяц 4-5 селфи с девушкой
    - Раз в неделю какая-нибудь забавная хуйня в окружающем мире
    - Раз в день 2-3 скриншотика забавной херни

## Найти

Возможность скидывать фотки и теоретически хранить их более 20 лет, при этом не сильно напрягая паранойю и не тратя много бабла

## Не надо искать

Лёгкий доступ к любой фотке в любой момент времени с любого девайса

## Текущее решение

1. Фотографии с iPhone и iPad отправляются на ноутбук через AirDrop как есть
2. Последние добавленные из загрузок перекочёвывают в тематическую папку
3. Затем ручками удаляются с iPhone и iPad. Или не ручками, вроде находил какую-то возможность. В общем на телефоне не остаётся не одной картинки/видео.
4. Тематическая папка пакуется в архив `год.месяц.адекватное человекопонятное имя.tar.gz`
5. Архив шифруется простым паролем, перебрать который не сильно большая проблема, но вряд ли нафиг сдалось кому-то чтобы тратить на это вычислительные мощности и ресурсы.

Для пятого пункта я использую два враппера:

`~/bin/encrypt:`

``` shell
#!/bin/sh

set -eu
openssl enc -aes-256-cbc -salt -in "$1" -out "${2:-$1.enc}"
```

и `~/bin/decrypt`

``` shell
#!/bin/bash

set -eu
openssl enc -aes-256-cbc -d -in "$1" -out "$2"
```

Далее:

1. этот зашифрованный архив отправляется во все доступные бесплатные облака (и к товарищу майору).
2. копируется на 2Тб жёсткий диск
3. фото с 2Тб диска периодически синхронизируются со съёмным диском для бэкапов на 1Тб.

## Его проблемы:

- Airdrop при большом числе фото и видео зависает и ничего не скидывает
- Удалять фото с девайсов вручную долго и неудобно
- Выделять фотографии тоже неудобно
- Искать кабель для подключения фоток к ноуту неудобно
- Стандартный софт MacOS не совсем предполагает работу с фотографиями как с долбанными файлами и папками и слишком умничает
- Необходимо помнить пароли которым зашифрованы архивы
- Нужно не забывать удалять фотографии в незашифрованном виде с остальных носителей (и из корзины) в случае их кражи
- Я какой-то ебанутый, надо ведь в инстаграмм всё выкладывать

## В Linux опять не работает импорт фоток с iPhone

1. Если не монтируется камера, но монтируются документы, CTRL-L и убираем котика `:3` из URL.
2. Копируем папки DCIM/APPLE109, 110 итд в любую папку.
3. Запускаем в ней:

``` shell
#!/bin/bash

set -euE

sort_source_apple_directories_by_date() {
	local filename date new_directory year month day
	find *APPLE/ -type f | while read -r filename; do
		m_time="$(stat -c %y $filename)"
		date=${m_time%% *}
		IFS='-' read -r year month day <<<"$date"
		new_directory="$year.$month/$day"
		mkdir -p "$new_directory"
		mv -v "$filename" "$new_directory"
	done
	return 0
}

heif_convert() {
	local dir_name file_name
	find -maxdepth 1 -mindepth 1 -type d -name '20*' | while read -r dir_name; do
		find "$dir_name" -type f -name "*.HEIC" | while read -r file_name; do
			heif-convert -q 100 "$file_name" "${file_name%.HEIC}.JPG" && rm -vf "$file_name"
		done
	done
}

sort_source_apple_directories_by_date
heif_convert

exit 0
```
